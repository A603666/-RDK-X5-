# 基于RDKX5与火山引擎的渔场管理系统

## 🆕 最新优化更新 (2025-07-05)

### 🔧 系统优化
- **启用LSTM预测模型**: 实现真正的AI水质预测，提高预测精度
- **修复坐标系统**: 统一使用GCJ02坐标系，解决地图位置偏移问题
- **增强安全性**: 移除硬编码敏感信息，使用环境变量管理API密钥
- **改进错误处理**: 前端显示用户友好的错误信息，增强系统稳定性


## 系统概述

这是一个完整的渔场管理系统，集成了实时水质监测、智能预测、无人船巡航控制和AI助手功能。系统采用Flask后端 + HTML/CSS/JavaScript前端的架构。

## 功能特性

### 🌊 监测页面功能
- **实时水质监测**：水温、溶解氧、pH值、TDS值、浊度
- **LSTM预测模型**：基于历史数据预测未来24小时水质变化，支持统计模型备用
- **智能风险评估**：自动分析预测结果并提供风险等级和管理建议
- **数据可视化**：实时图表展示水质变化趋势，支持多参数切换
- **自动数据记录**：每分钟自动记录水质数据到CSV文件
- **离线状态提示**：网络异常时显示离线状态，支持重试机制

### 🚢 控制页面功能
- **巡航路径管理**：GPS坐标点存储和管理，支持GCJ02坐标系
- **实时巡航控制**：开始/停止巡航，获取巡航状态
- **药品投放系统**：双药仓管理，标准化用药剂量
- **设备状态监控**：实时显示设备运行状态和电池电量

### 🤖 AI助手功能
- **Coze API集成**：智能对话和问题解答，支持流式响应
- **水质分析建议**：基于当前数据提供专业建议
- **实时状态监控**：设备运行状态和异常报警
- **对话历史管理**：支持会话记录和上下文理解

## 安装和部署

### 1. 环境要求
- Python 3.8+
- Windows

### 2. 快速安装
```bash
# 克隆或下载项目文件
# 安装基础依赖
pip install flask flask-cors pandas numpy scipy schedule python-dotenv requests

# 可选：安装完整依赖（包含TensorFlow）
pip install -r requirements.txt
```

### 3. 环境配置
复制 `.env.example` 为 `.env` 并配置相关参数：
```bash
cp .env.example .env
```

编辑 `.env` 文件，填入你的Coze API凭证（可选）。

### 4. 启动系统
```bash
python app.py
```

系统启动后会显示：
```
正在初始化渔场管理系统后端...
✓ 数据文件初始化完成
✓ 初始水质数据生成完成
✓ 演示预测数据生成完成
✓ 定时预测任务启动完成
✓ 水质数据定时生成启动完成
🚀 渔场管理系统后端初始化完成！
```

### 5. 访问系统
打开浏览器访问：`http://localhost:5001`

### 6. 测试API
运行测试脚本验证所有功能：
```bash
python test_api.py
```

## API接口文档

### 水质监测API
- `GET /api/water-quality/current` - 获取当前水质数据
- `GET /api/water-quality/history?hours=24` - 获取历史数据
- `POST /api/water-quality/predict` - 触发水质预测
- `GET /api/water-quality/prediction` - 获取预测结果

### 巡航控制API
- `POST /api/cruise/start` - 开始巡航
- `GET /api/cruise/status` - 获取巡航状态
- `POST /api/cruise/stop` - 停止巡航
- `GET /api/cruise/path` - 获取巡航路径

### AI助手API
- `POST /api/chat` - 与AI助手对话
- `GET /api/health` - 健康检查

## 数据文件说明

- `water_quality_data.csv` - 水质历史数据
- `cruise_path.csv` - 巡航路径GPS坐标
- `.env` - 环境变量配置

## 技术架构

### 后端技术栈
- **Flask** - Web框架
- **TensorFlow/Keras** - LSTM预测模型
- **pandas/numpy** - 数据处理
- **scipy** - 路径平滑算法
- **schedule** - 定时任务

### 前端技术栈
- **HTML5/CSS3/JavaScript** - 基础前端技术
- **TailwindCSS** - UI框架
- **Recharts** - 图表库
- **高德地图API** - 地图服务

## 系统特色

### 🎯 精确的水质预测
- 使用高级统计模型（可升级为LSTM神经网络）
- 基于历史数据训练和趋势分析
- 每天自动更新预测结果
- 支持多参数同时预测（水温、溶解氧、pH、TDS、浊度）

### 🛣️ 智能路径规划
- 贝塞尔曲线路径平滑算法
- GPS坐标精度6位小数
- 支持自定义巡航路径
- 实时位置追踪和状态监控

### 📊 实时数据监控
- 每分钟自动采集数据
- 符合池塘养殖标准的数据范围
- 自动异常检测和报警
- 历史数据趋势分析

## 功能演示

### 水质监测演示
系统自动生成符合真实池塘环境的水质数据：
- **水温**：25-33°C，变化幅度±0.5°C
- **溶解氧**：6-8 mg/L，变化幅度±0.3 mg/L
- **pH值**：7.0-7.5，变化幅度±0.2
- **TDS值**：300-400 ppm，变化幅度±20 ppm
- **浊度**：2-4 NTU，变化幅度±0.5 NTU

### 预测功能演示
访问 `/api/water-quality/predict` 可获得未来24小时的水质预测，包括：
- 基于历史趋势的预测值
- 考虑日夜周期变化
- 智能异常检测和风险评估

### 巡航控制演示
系统提供完整的GPS巡航路径：
- 华中科技大学渔场坐标点
- 50个平滑插值点
- 支持路径可视化和实时追踪

## 开发和扩展

### 添加新的水质参数
1. 在 `WATER_QUALITY_CONFIG` 中添加参数配置
2. 更新数据生成函数
3. 修改前端显示组件

### 集成真实硬件设备
1. 替换虚拟数据生成函数
2. 添加设备通信协议
3. 实现设备状态监控

### 扩展AI功能
1. 配置Coze API凭证
2. 自定义AI助手提示词
3. 添加专业领域知识库

## 故障排除

### 常见问题
1. **依赖安装失败**：确保Python版本3.8+，使用虚拟环境
2. **TensorFlow安装问题**：根据系统选择合适的TensorFlow版本
3. **API调用失败**：检查网络连接和API凭证配置

### 日志查看
系统启动时会显示详细的初始化日志，包括：
- 数据文件初始化状态
- 预测模型加载状态
- 定时任务启动状态

## 许可证

本项目采用MIT许可证。

## 联系方式

如有问题或建议，请联系开发团队。
